name: Big Alpha Kings Automated Data Pipeline

on:
  schedule:
    # Run at 4:00 PM EST on specific dates
    # 2024-09-10, 2024-10-16, 2024-11-14, 2024-12-11
    - cron: '0 21 10 9 *'   # Sept 10 at 4pm EST (9pm UTC)
    - cron: '0 21 16 10 *'  # Oct 16 at 4pm EST (9pm UTC) 
    - cron: '0 21 14 11 *'  # Nov 14 at 4pm EST (9pm UTC)
    - cron: '0 21 11 12 *'  # Dec 11 at 4pm EST (9pm UTC)
  
  # Allow manual triggering
  workflow_dispatch:
    inputs:
      reason:
        description: 'Reason for manual run'
        required: false
        default: 'Manual trigger'

jobs:
  update-data:
    runs-on: ubuntu-latest
    
    steps:
    - name: 🔥 Checkout Repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: 🐍 Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: 📦 Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas requests openai firebase-admin fastapi uvicorn
    
    - name: 🚀 Run Automated Data Pipeline
      run: |
        echo "🔥 BIG ALPHA KINGS AUTOMATED DATA PIPELINE 🔥"
        echo "⏰ Running at: $(date)"
        python automated_data_pipeline.py
    
    - name: 📊 Check Results
      run: |
        echo "📈 Checking generated files..."
        ls -la AIBrain/JSONS/
        echo "📊 File sizes:"
        du -h AIBrain/JSONS/*.json
    
    - name: 🎉 Pipeline Complete
      run: |
        echo "✅ Automated data pipeline completed successfully!"
        echo "🚀 AI data is now fresh and deployed!"
        echo "📅 Next scheduled run: Check workflow schedule"
